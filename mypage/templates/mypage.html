{% extends 'base.html' %}
{% load static %}

{% block title %}Mypage{% endblock %}

{% block extra_head %}
<!-- ğŸ“Œ ê³µí†µ ìŠ¤íƒ€ì¼ ì‹œíŠ¸ ë¶ˆëŸ¬ì˜¤ê¸° -->
<link rel="stylesheet" href="{% static 'css/main.css' %}">

<!-- ğŸ“Œ ë§ˆì´í˜ì´ì§€ ì „ìš© ìŠ¤íƒ€ì¼ ì‹œíŠ¸ -->
<link rel="stylesheet" href="{% static 'css/mypage.css' %}">

<!-- âœ… CSRF í† í°ì„ JSì—ì„œ ì‚¬ìš©í•˜ê¸° ìœ„í•´ ë©”íƒ€ íƒœê·¸ë¡œ ì‚½ì… -->
<meta name="csrf-token" content="{{ csrf_token }}">
{% endblock %}


{% block content %}
<!-- ğŸ”µ ë§ˆì´í˜ì´ì§€ ìƒë‹¨ í”„ë¡œí•„ ì˜ì—­ -->
<div class="mypage-container">
  <!-- ì™¼ìª½ í”„ë¡œí•„ ë°•ìŠ¤ -->
  <div class="profile-box">
    {% if form.profile_picture.value %}
      <img src="{% static 'images/profiles/'|add:form.profile_picture.value %}" alt="Profile Picture" class="profile-picture">
    {% else %}
      <img src="{% static 'images/logo-black.png' %}" alt="Default Picture" class="profile-picture">
    {% endif %}
    <h2>{{ form.username.value }}</h2>
    <p class="nickname-display">{{ form.nickname.value }}</p>
    <button id="openPasswordBtn" class="edit-profile-btn">í”„ë¡œí•„ ìˆ˜ì •</button>
  </div>

  <!-- ì˜¤ë¥¸ìª½ ì»¨í…ì¸ : ë²„íŠ¼ + ëª©ë¡ -->
  <div class="content-box">
    <div class="link-buttons">
      <a href="javascript:void(0);" class="mypage-link-btn lyrics-btn" data-type="lyrics">AIë®¤ì¦ˆ</a>
      <a href="javascript:void(0);" class="mypage-link-btn" data-type="button2">ê²Œì‹œê¸€</a>
      <a href="javascript:void(0);" class="mypage-link-btn" data-type="button3">ì¢‹ì•„ìš”ëª©ë¡</a>
      <a href="javascript:void(0);" class="mypage-link-btn" data-type="button4">ê³ ê°ì„¼í„°</a>
    </div>
    <!-- ë²„íŠ¼ ì•„ë˜ êµ¬ë¶„ì„  ì¶”ê°€ -->
    <!-- <div class="link-divider"></div> -->

    <table id="user-lyrics-table" class="lyrics-table" style="display: none;">
      <thead id="table-head">
        <tr class="table-header">
          <th class="col-select">
            <input type="checkbox" id="select-all" title="ì „ì²´ ì„ íƒ">
          </th>
          <th class="col-title">
             <span class="th-title-main">ì œëª©</span>
            <span class="th-title-sub">   (ì¥ë¥´ / ì–¸ì–´) </span>
          </th>
          <th class="col-date"> ì‘ì„±ì¼</th>
        </tr>
      </thead>
      <tbody id="user-lyrics-body">
        <!-- JSë¡œ ë™ì ìœ¼ë¡œ ì¶”ê°€ë¨ -->
      </tbody>
    </table>

    <!-- âœ… ì‚­ì œ ë²„íŠ¼ + í˜ì´ì§€ë„¤ì´ì…˜ ë¶„ë¦¬ -->
    <div class="lyrics-controls-wrapper">
      <div class="left-controls">
        <button id="delete-selected" class="delete-btn">ì„ íƒ ì‚­ì œ</button>
      </div>
      <div class="center-pagination">
        <div class="pagination" id="pagination"></div>
      </div>
    </div>
  </div>
</div>

<!-- ğŸ” ë¹„ë°€ë²ˆí˜¸ í™•ì¸ ëª¨ë‹¬ -->
<div id="passwordModal" class="mypage-modal">
  <div class="modal-content">
    <span class="modal-close" onclick="closePasswordModal()">&times;</span>
    <h2>ë¹„ë°€ë²ˆí˜¸ í™•ì¸</h2>
    <input type="password" id="confirmPassword" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
    <button class="save-btn" onclick="verifyPassword()">í™•ì¸</button>
  </div>
</div>

<!-- âœï¸ í”„ë¡œí•„ ìˆ˜ì • ëª¨ë‹¬ -->
<div id="editModal" class="mypage-modal">
  <div class="modal-content">
    <span class="modal-close" onclick="closeModal()">&times;</span>
    <h2>í”„ë¡œí•„ ìˆ˜ì •</h2>

    <!-- ğŸ” ìˆ˜ì • í¼ ì‹œì‘ -->
    <form method="POST" class="profile-form">
      {% csrf_token %}

      <!-- âœ… ì•„ì´ë””(ì½ê¸° ì „ìš©) -->
      <label>ID</label>
      <input type="text" name="username" id="id_username" value="{{ form.username.value }}" readonly>

      <!-- âœ… ë‹‰ë„¤ì„ ì…ë ¥ -->
      <label for="id_nickname">ë‹‰ë„¤ì„</label>
      <input type="text" name="nickname" id="id_nickname"
            value="{{ form.nickname.value|default_if_none:'' }}"
            placeholder="ë‹‰ë„¤ì„ ì…ë ¥">
      {% if form.nickname.errors %}
        <div class="nickname-error error" style="color:red">{{ form.nickname.errors.0 }}</div>
      {% endif %}

      <!-- âœ… ìƒì¼ ì…ë ¥ -->
      <label for="id_birthday">ìƒì¼</label>
      <input type="date" name="birthday" id="id_birthday"
             value="{{ form.birthday.value|date:'Y-m-d' }}">

      <!-- âœ… ì „í™”ë²ˆí˜¸ ì…ë ¥ -->
      <label for="id_phone_number">ì „í™”ë²ˆí˜¸</label>
      <input type="text" name="phone_number" id="id_phone_number"
             value="{{ form.phone_number.value|default_if_none:'' }}" placeholder="010-1234-5678">

      <!-- âœ… í”„ë¡œí•„ ì´ë¯¸ì§€ ì„ íƒ -->
      <label for="id_profile_picture">í”„ë¡œí•„ ì‚¬ì§„ ì„ íƒ</label>
      <select name="profile_picture" id="id_profile_picture" class="form-control">
        {% for val, label in form.fields.profile_picture.choices %}
          <option value="{{ val }}" {% if form.profile_picture.value == val %}selected{% endif %}>{{ label }}</option>
        {% endfor %}
      </select>

      <!-- âœ… ì‹¤ì‹œê°„ ë¯¸ë¦¬ë³´ê¸° ì˜ì—­ -->
      <div class="preview-box">
        <img id="profilePreview" src="{% static 'images/profiles/' %}{{ form.profile_picture.value }}" class="profile-preview" alt="ì„ íƒëœ í”„ë¡œí•„ ë¯¸ë¦¬ë³´ê¸°">
      </div>

      <!-- âœ… ë¹„ë°€ë²ˆí˜¸ hidden ì²˜ë¦¬ (ìˆ˜ì • ì‹œ ê²€ì¦ìš©) -->
      <input type="hidden" name="password" id="hiddenPassword">

      <!-- âœ… ìˆ˜ì • ë²„íŠ¼ (ì¡°ê±´ ì¶©ì¡±í•´ì•¼ í™œì„±í™”ë¨) -->
      <button type="submit" id="submit-btn" disabled class="btn btn-primary">ìˆ˜ì •</button>
    </form>
  </div>
</div>

<!-- ì´ë¯¸ì§€ í™•ëŒ€ ë¯¸ë¦¬ë³´ê¸° ëª¨ë‹¬ -->
<div id="imagePreviewModal" class="image-modal">
  <button id="closePreviewBtn" class="close-btn">Ã—</button>
  <img id="previewImage" src="" alt="í™•ëŒ€ ì´ë¯¸ì§€">
</div>
{% endblock %}

{% block extra_script %}
<script src="{% static 'js/base.js' %}"></script>
<script src="{% static 'js/mypage.js' %}"></script>

{% endblock %}
