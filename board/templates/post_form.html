{% extends 'base.html' %}
{% load static %}

{% block title %}Post{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'css/main.css' %}">
<link rel="stylesheet" href="{% static 'css/post_form.css' %}">
{% endblock %}

{% block content %}
<!-- âœ… Modal positioned outside the form -->
<div id="lovelistModalBackdrop" class="modal-backdrop"></div>
<div id="lovelistModal" class="modal">
  <div class="modal-content">
    <h3>ì¢‹ì•„ìš” ëª©ë¡</h3>
    <div class="lovelist-select">
      {% for song in lovelist %}
      <label >
        <input type="checkbox" name="songs" class="song-checkbox" value="{{ song.id }}">
        {{ song.title }} - {{ song.artist }}
      </label><br>
      {% empty %}
      <p>No liked songs available.</p>
      {% endfor %}
    </div>
    <button type="button" id="closeLovelistModal" class="btn-submit">ì„ íƒ ì™„ë£Œ</button>
  </div>
</div>

<!-- âœ… Form content -->
<div class="post-form-wrapper">
  <div class="post-form-container">
    <a href="{% url 'post_list' %}" class="back-to-board-btn">â† ê²Œì‹œíŒìœ¼ë¡œ ì´ë™</a>
    <h1 class="post-form-title">New Post</h1>

    <form method="POST" enctype="multipart/form-data" id="postForm">
      {% csrf_token %}

      <label for="id_title">ì œëª©</label>
      {{ form.title }}

      <label for="id_description">ë‚´ìš©</label>
      {{ form.description }}

      <div class="playlist-label-button-wrapper">
        <label>í”Œë ˆì´ë¦¬ìŠ¤íŠ¸</label>
        <button type="button" id="openLovelistModal">ğŸµ ê³¡ ì„ íƒ</button>
      </div>


      <!-- âœ… Place to insert hidden inputs for selected songs -->
      <div id="selectedSongsHiddenInputs"></div>

      <div id="selectedSongsPreview" class="selected-songs-preview">
        <p class="no-selection">ì„ íƒëœ ê³¡ì´ ì—†ìŠµë‹ˆë‹¤.</p>
      </div>

      <label for="id_thumbnail">ì¸ë„¤ì¼ ì´ë¯¸ì§€</label>
      {{ form.thumbnail }}

      <button type="submit" class="btn-submit">ë“±ë¡</button>
    </form>

  </div>
</div>
{% endblock %}

{% block extra_script %}
<script>
  const previouslySelectedSongIds = {{ selected_song_ids|default:"[]"|safe }};
</script>

<script src="{% static 'js/base.js' %}"></script>
<script src="{% static 'js/post_form.js' %}"></script>
{% endblock %}